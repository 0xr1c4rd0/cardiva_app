# Phase 10.1: RFP Upload Polish & Multi-User - Context

**Gathered:** 2026-01-23
**Status:** Ready for planning
**Type:** INSERTED (urgent work between Phase 10)

<domain>
## Phase Boundary

Enhance the RFP upload system with multi-file support, fix critical sorting bug, update KPI calculations, and enable multi-user collaboration. All users can see, edit, and delete any RFP with real-time sync.

**Includes:**
- Fix match review table sorting (critical bug)
- Fix KPI calculations with new 3-state model
- Multi-RFP upload with concurrent processing
- Multi-user visibility and editing
- Show uploader/editor information
- Align inventory table design with matches table

**Does NOT include:**
- Export/email functionality (Phase 9)
- Search/filter for RFPs page (Phase 10)

</domain>

<decisions>
## Implementation Decisions

### KPI Definitions (3-State Model)
- **Por Rever**: RFPs with at least 1 item that has pending suggestions not yet decided
- **Revistos**: RFPs where all items addressed, but user hasn't clicked "Confirm"
- **Confirmados**: RFPs where user clicked "Confirm" button, ready for export/email
- Auto-accepted 100% matches count as "reviewed" (no user action needed)
- Display as 3 separate KPI chips on RFPs page

### Confirmation Workflow
- New "Confirm" button required on match review page
- Export/email only enabled after confirmation
- Prevents users from missing RFPs with no matches to review

### Multi-Upload Behavior
- Max 10 RFPs can be uploaded at once (queue limit)
- Upload button NEVER disabled during processing
- Individual progress for each file (not combined)
- Show max 3 progress bars stacked vertically
- Each progress bar shows: filename, percentage, time since started (same as current single-RFP)
- Overflow: collapsible section showing queued filenames + inline badge on upload button
- For bulk upload: trigger n8n webhook per file with 2-3sec delay between each

### Multi-User Permissions
- ALL authenticated users can see ALL RFPs (remove user_id filter)
- ANY user can accept/reject matches on ANY RFP
- ANY user can delete/cancel ANY RFP job
- Real-time sync via Supabase Realtime (no toasts for external changes)
- Show "last edited by" in addition to uploader

### Uploader/Editor Display
- Show name if available in profiles, otherwise email
- Format: "há 2 horas • João Silva • Editado por Maria"
- Position: next to timestamp in RFP list
- No truncation for names/emails (let content flow)

### Table Sorting Fix (Critical)
- Match review table sorting broken: URL updates but data doesn't refresh
- Root cause: nuqs setParams with shallow: false not triggering server re-render
- Must fix before other work proceeds

### Table Design Alignment
- After sorting fix, update inventory table to match review table styling
- Same border, shadow, header background, row hover states, sort icons

### Claude's Discretion
- Exact progress bar stacking and animation
- Collapsible section UI for overflow queue
- Badge design for queue count
- Database schema for tracking last_edited_by
- RLS policy updates for multi-user access

</decisions>

<specifics>
## Specific Ideas

- Progress bars stack vertically, same info as current single-RFP progress
- Collapsible shows filenames of queued docs
- Real-time means if User A accepts a match, User B sees it instantly
- 3 KPIs: "Por Rever: X" | "Revistos: Y" | "Confirmados: Z"

</specifics>

<deferred>
## Deferred Ideas

None — discussion stayed within phase scope

</deferred>

---

*Phase: 10.1-rfp-upload-polish*
*Context gathered: 2026-01-23*
