---
phase: 10.1-rfp-upload-polish
plan: 05
type: execute
wave: 2
depends_on: ["10.1-04"]
files_modified:
  - src/app/(dashboard)/rfps/components/rfp-jobs-list.tsx
  - src/app/(dashboard)/rfps/page.tsx
  - src/app/(dashboard)/inventory/components/inventory-table.tsx
autonomous: true

must_haves:
  truths:
    - "RFP list shows uploader name/email next to timestamp"
    - "RFP list shows 'Editado por X' if last_edited_by differs from uploader"
    - "Format: 'ha 2 horas - Joao Silva - Editado por Maria'"
    - "Names preferred over emails when available"
    - "Inventory table styling matches match-review-table"
  artifacts:
    - path: "src/app/(dashboard)/rfps/components/rfp-jobs-list.tsx"
      provides: "Uploader and editor display"
      contains: "Editado por"
    - path: "src/app/(dashboard)/rfps/page.tsx"
      provides: "Query with profile joins"
      contains: "uploader:profiles"
    - path: "src/app/(dashboard)/inventory/components/inventory-table.tsx"
      provides: "Table styling aligned with match-review-table"
      contains: "rounded-lg border border-slate-200 shadow-xs"
  key_links:
    - from: "rfp-jobs-list.tsx"
      to: "profiles table"
      via: "Supabase join"
      pattern: "profiles"
    - from: "page.tsx"
      to: "profiles table"
      via: "Supabase join"
      pattern: "uploader:profiles"
---

<objective>
Display uploader and last editor information on RFP list items, and align inventory table styling with the match review table design.

Purpose: In a multi-user environment, team members need to see who uploaded each RFP and who last edited it. This provides accountability and context. Additionally, visual consistency between tables improves the user experience.

Output: Updated RFP list with uploader/editor display, and inventory table with consistent styling.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10.1-rfp-upload-polish/10.1-CONTEXT.md
@.planning/phases/10.1-rfp-upload-polish/10.1-RESEARCH.md
@.planning/phases/10.1-rfp-upload-polish/10.1-04-SUMMARY.md
@src/app/(dashboard)/rfps/components/rfp-jobs-list.tsx
@src/app/(dashboard)/rfps/page.tsx
@src/app/(dashboard)/inventory/components/inventory-table.tsx
@src/app/(dashboard)/rfps/components/match-review-table.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update RFP jobs list and page to show uploader and editor</name>
  <files>
    src/app/(dashboard)/rfps/components/rfp-jobs-list.tsx
    src/app/(dashboard)/rfps/page.tsx
  </files>
  <action>
**Pre-flight check - Profiles schema verification:**
The profiles table schema (from supabase/migrations/20260121_profiles_and_auth_hook.sql) has:
- `id` (UUID, references auth.users)
- `email` (TEXT)
- `role` (user_role enum)
- `approved_at`, `created_at`, `updated_at` (TIMESTAMPTZ)

Note: There is NO `full_name` column. Use `email` only for user display.

**Update page.tsx (required for profile joins):**

1. Update the Supabase query to join profiles:
   ```typescript
   const { data: jobs } = await supabase
     .from('rfp_upload_jobs')
     .select(`
       *,
       uploader:profiles!user_id(email),
       last_editor:profiles!last_edited_by(email)
     `)
     // ... rest of query (sorting, pagination, search filters)
     // NO user_id filter (multi-user from Plan 10.1-04)
   ```

**Update rfp-jobs-list.tsx:**

1. Update the RFPJob interface to include profile data:
   ```typescript
   interface RFPJob {
     id: string
     file_name: string
     file_size: number | null
     status: 'pending' | 'processing' | 'completed' | 'failed'
     error_message: string | null
     created_at: string
     completed_at: string | null
     user_id: string
     last_edited_by: string | null
     // Joined profile data (email only - no full_name in profiles table)
     uploader?: {
       email: string
     }
     last_editor?: {
       email: string
     } | null
   }
   ```

2. Create helper function to format user display (email only):
   ```typescript
   function formatUserEmail(profile: { email: string } | null | undefined): string | null {
     if (!profile) return null
     // Extract name portion before @ for cleaner display
     const emailName = profile.email.split('@')[0]
     // Capitalize first letter of each word
     return emailName
       .split(/[._-]/)
       .map(part => part.charAt(0).toUpperCase() + part.slice(1))
       .join(' ')
   }
   ```

3. Update the job item rendering to show uploader/editor:
   - Current format: "2.5 MB - ha 2 horas"
   - New format: "2.5 MB - ha 2 horas - Joao Silva" (uploader only)
   - Or if edited by someone else: "2.5 MB - ha 2 horas - Joao Silva - Editado por Maria"

   ```tsx
   <div className="flex items-center gap-2 text-sm text-muted-foreground">
     {job.file_size && (
       <span>{(job.file_size / 1024 / 1024).toFixed(2)} MB</span>
     )}
     <span>-</span>
     <span>
       {formatDistanceToNow(new Date(job.created_at), { addSuffix: true, locale: pt })}
     </span>
     {job.uploader && (
       <>
         <span>-</span>
         <span>{formatUserEmail(job.uploader)}</span>
       </>
     )}
     {job.last_editor && job.last_edited_by !== job.user_id && (
       <>
         <span>-</span>
         <span className="text-muted-foreground/80">
           Editado por {formatUserEmail(job.last_editor)}
         </span>
       </>
     )}
   </div>
   ```
  </action>
  <verify>
1. Run `npm run build` to verify no TypeScript errors
2. Navigate to /rfps page
3. Verify each RFP shows uploader email (formatted as name) after timestamp
4. Make an edit as different user
5. Verify "Editado por X" appears for that RFP
  </verify>
  <done>
- RFP list shows uploader email (formatted as name)
- Shows "Editado por X" when last_edited_by differs from user_id
- Email formatted as readable name (joao.silva@example.com -> Joao Silva)
- Format matches spec: "ha X horas - Uploader - Editado por Editor"
  </done>
</task>

<task type="auto">
  <name>Task 2: Align inventory table styling with match-review-table</name>
  <files>src/app/(dashboard)/inventory/components/inventory-table.tsx</files>
  <action>
**Pre-flight check - Reference styling exists:**
First, verify match-review-table.tsx exists and contains the reference styling patterns by reading the file. The expected styling (from match-review-table.tsx lines 194-271):

- Table container: `rounded-lg border border-slate-200 shadow-xs overflow-hidden bg-white p-2`
- Table class: `[&_thead_tr]:border-0`
- Header row: `hover:bg-transparent border-0`
- Header cells: `text-xs font-medium text-slate-700 tracking-wide bg-slate-100/70 py-2 px-3`
- First header: `pl-4 rounded-l-md`
- Last header: `pr-4 rounded-r-md`
- Body rows: `hover:bg-slate-50` with implicit `border-0` from parent
- Body cells: `py-2 px-3 text-slate-700 text-sm`
- First cell: `pl-4`
- Last cell: `pr-4`

**Update inventory-table.tsx to match:**

1. Update container div:
   ```tsx
   <div className="rounded-lg border border-slate-200 shadow-xs overflow-hidden bg-white p-2">
   ```

2. Update Table component:
   ```tsx
   <Table className="[&_thead_tr]:border-0">
   ```

3. Update TableRow for header:
   ```tsx
   <TableRow className="hover:bg-transparent border-0">
   ```

4. Update TableHead styling:
   ```tsx
   <TableHead
     className={cn(
       "text-xs font-medium text-slate-700 tracking-wide bg-slate-100/70 py-2 px-3",
       index === 0 && "pl-4 rounded-l-md",
       index === headers.length - 1 && "pr-4 rounded-r-md"
     )}
   >
   ```

5. Update body rows:
   ```tsx
   <TableRow className="hover:bg-slate-50 border-0">
   ```

6. Update body cells:
   ```tsx
   <TableCell
     className={cn(
       "py-2 px-3 text-slate-700 text-sm",
       index === 0 && "pl-4",
       index === cells.length - 1 && "pr-4"
     )}
   >
   ```

7. Remove any ghost button styling from sortable headers that doesn't match:
   - Match-review-table uses inline buttons with specific styling
   - Make sure sort icons and interaction match

8. Compare empty state styling and skeleton loading to ensure consistency.
  </action>
  <verify>
1. Run `npm run build` to verify no TypeScript errors
2. Navigate to /inventory page
3. Compare visually with /rfps/{id}/matches page
4. Verify: border style, shadow, header background, row hover, sort icons
5. Both tables should look like they're from the same design system
  </verify>
  <done>
- Inventory table border matches: rounded-lg border-slate-200 shadow-xs
- Header background: bg-slate-100/70 with rounded corners
- Row hover state: hover:bg-slate-50
- Sort icons style and position match
- Overall visual consistency achieved
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. RFP list shows uploader for each item
3. RFP list shows "Editado por X" when appropriate
4. Inventory table visually matches match-review-table
5. Both tables feel like part of same design system
</verification>

<success_criteria>
- Uploader email (formatted) visible on all RFP list items
- Editor shown when last_edited_by differs from uploader
- Inventory table styling identical to match-review-table
- Visual consistency across both table components
</success_criteria>

<output>
After completion, create `.planning/phases/10.1-rfp-upload-polish/10.1-05-SUMMARY.md`
</output>
