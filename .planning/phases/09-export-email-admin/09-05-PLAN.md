---
phase: 09-export-email-admin
plan: 05
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - src/app/(dashboard)/admin/settings/page.tsx
  - src/app/(dashboard)/admin/settings/actions.ts
  - src/app/(dashboard)/admin/settings/email-settings-section.tsx
  - src/app/(dashboard)/admin/settings/export-fields-section.tsx
  - src/app/(dashboard)/admin/settings/inventory-fields-section.tsx
  - src/components/layout/app-sidebar.tsx
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Admin settings page exists at /admin/settings"
    - "Sidebar shows Definicoes link in admin section"
    - "Email Configuration section allows editing default recipients and behavior flags"
    - "Export Fields section shows two tables for rfp_items and rfp_match_suggestions columns"
    - "Inventory Fields section reuses existing inventory_column_config data"
    - "All sections have save buttons that persist changes to database"
  artifacts:
    - path: "src/app/(dashboard)/admin/settings/page.tsx"
      provides: "Admin settings page with 3 collapsible sections"
      exports: ["default"]
    - path: "src/app/(dashboard)/admin/settings/actions.ts"
      provides: "Server actions for saving settings"
      exports: ["updateEmailSettings", "updateExportColumnConfig", "updateInventoryColumnConfig"]
    - path: "src/components/layout/app-sidebar.tsx"
      provides: "Sidebar with settings link in admin section"
      contains: "/admin/settings"
  key_links:
    - from: "email-settings-section"
      to: "app_settings table"
      via: "updateEmailSettings server action"
      pattern: "from\\('app_settings'\\)"
    - from: "export-fields-section"
      to: "export_column_config table"
      via: "updateExportColumnConfig server action"
      pattern: "from\\('export_column_config'\\)"
---

<objective>
Create admin settings page with email, export fields, and inventory fields configuration.

Purpose: Allow admins to configure email recipients, export columns, and inventory display columns.
Output: New /admin/settings page with three collapsible configuration sections.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@docs/plans/2026-01-25-phase9-export-email-admin-design.md
@.planning/phases/09-export-email-admin/09-01-PLAN.md

# Sidebar for navigation
@src/components/layout/app-sidebar.tsx

# Existing admin pages for pattern reference
@src/app/(dashboard)/admin/users/page.tsx
@src/app/(dashboard)/admin/users/actions.ts

# Existing inventory column config migration
@supabase/migrations/20260121_inventory_column_config.sql
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create server actions for settings</name>
  <files>src/app/(dashboard)/admin/settings/actions.ts</files>
  <action>
Create server actions file:

```typescript
'use server'

import { createClient } from '@/lib/supabase/server'
import { requireAdmin } from '@/lib/auth/utils'
import { revalidatePath } from 'next/cache'

interface EmailSettingsInput {
  email_default_recipients: string[]
  email_user_can_edit: boolean
  email_defaults_replaceable: boolean
}

export async function updateEmailSettings(settings: EmailSettingsInput) {
  await requireAdmin()

  const supabase = await createClient()
  const { data: { user } } = await supabase.auth.getUser()

  const { error } = await supabase
    .from('app_settings')
    .update({
      ...settings,
      updated_at: new Date().toISOString(),
      updated_by: user?.id,
    })
    .eq('id', 1)

  if (error) {
    console.error('updateEmailSettings error:', error)
    return { error: error.message }
  }

  revalidatePath('/admin/settings')
  return { success: true }
}

interface ColumnConfigInput {
  id: number
  display_name: string
  visible: boolean
  display_order: number
}

export async function updateExportColumnConfig(columns: ColumnConfigInput[]) {
  await requireAdmin()

  const supabase = await createClient()

  // Update each column
  for (const col of columns) {
    const { error } = await supabase
      .from('export_column_config')
      .update({
        display_name: col.display_name,
        visible: col.visible,
        display_order: col.display_order,
        updated_at: new Date().toISOString(),
      })
      .eq('id', col.id)

    if (error) {
      console.error('updateExportColumnConfig error:', error)
      return { error: error.message }
    }
  }

  revalidatePath('/admin/settings')
  return { success: true }
}

export async function updateInventoryColumnConfig(columns: ColumnConfigInput[]) {
  await requireAdmin()

  const supabase = await createClient()

  for (const col of columns) {
    const { error } = await supabase
      .from('inventory_column_config')
      .update({
        display_name: col.display_name,
        visible: col.visible,
        display_order: col.display_order,
        updated_at: new Date().toISOString(),
      })
      .eq('id', col.id)

    if (error) {
      console.error('updateInventoryColumnConfig error:', error)
      return { error: error.message }
    }
  }

  revalidatePath('/admin/settings')
  revalidatePath('/inventory')
  return { success: true }
}

export async function syncExportColumns() {
  await requireAdmin()

  const supabase = await createClient()

  const { error } = await supabase.rpc('sync_export_columns')

  if (error) {
    console.error('syncExportColumns error:', error)
    return { error: error.message }
  }

  revalidatePath('/admin/settings')
  return { success: true }
}
```
  </action>
  <verify>
File exists: `ls src/app/(dashboard)/admin/settings/actions.ts`
Email action: `grep "export async function updateEmailSettings" src/app/(dashboard)/admin/settings/actions.ts`
Export action: `grep "export async function updateExportColumnConfig" src/app/(dashboard)/admin/settings/actions.ts`
Inventory action: `grep "export async function updateInventoryColumnConfig" src/app/(dashboard)/admin/settings/actions.ts`
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Server actions for all three settings sections created</done>
</task>

<task type="auto">
  <name>Task 2: Create EmailSettingsSection component</name>
  <files>src/app/(dashboard)/admin/settings/email-settings-section.tsx</files>
  <action>
Create the email settings section component:

```typescript
'use client'

import { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Label } from '@/components/ui/label'
import { Switch } from '@/components/ui/switch'
import { Badge } from '@/components/ui/badge'
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from '@/components/ui/collapsible'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { ChevronDown, X, Plus, Loader2, Mail } from 'lucide-react'
import { toast } from 'sonner'
import type { AppSettings } from '@/types/app-settings'
import { updateEmailSettings } from './actions'

interface EmailSettingsSectionProps {
  initialSettings: AppSettings | null
}

export function EmailSettingsSection({ initialSettings }: EmailSettingsSectionProps) {
  const [isOpen, setIsOpen] = useState(true)
  const [isSaving, setIsSaving] = useState(false)
  const [recipients, setRecipients] = useState<string[]>(
    initialSettings?.email_default_recipients || []
  )
  const [userCanEdit, setUserCanEdit] = useState(
    initialSettings?.email_user_can_edit ?? true
  )
  const [defaultsReplaceable, setDefaultsReplaceable] = useState(
    initialSettings?.email_defaults_replaceable ?? true
  )
  const [newEmail, setNewEmail] = useState('')

  const handleAddEmail = () => {
    const email = newEmail.trim().toLowerCase()
    if (!email || !email.includes('@')) {
      toast.error('Introduza um email valido')
      return
    }
    if (recipients.includes(email)) {
      toast.error('Este email ja existe')
      return
    }
    setRecipients([...recipients, email])
    setNewEmail('')
  }

  const handleRemoveEmail = (email: string) => {
    setRecipients(recipients.filter(e => e !== email))
  }

  const handleSave = async () => {
    setIsSaving(true)
    try {
      const result = await updateEmailSettings({
        email_default_recipients: recipients,
        email_user_can_edit: userCanEdit,
        email_defaults_replaceable: defaultsReplaceable,
      })

      if (result.success) {
        toast.success('Definicoes de email guardadas')
      } else {
        toast.error(result.error || 'Erro ao guardar')
      }
    } catch (error) {
      toast.error('Erro ao guardar definicoes')
    } finally {
      setIsSaving(false)
    }
  }

  return (
    <Collapsible open={isOpen} onOpenChange={setIsOpen}>
      <Card>
        <CollapsibleTrigger asChild>
          <CardHeader className="cursor-pointer hover:bg-muted/50 transition-colors">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Mail className="h-5 w-5" />
                <div>
                  <CardTitle className="text-lg">Configuracao de Email</CardTitle>
                  <CardDescription>
                    Definir destinatarios padrao e permissoes de edicao
                  </CardDescription>
                </div>
              </div>
              <ChevronDown className={`h-5 w-5 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
            </div>
          </CardHeader>
        </CollapsibleTrigger>
        <CollapsibleContent>
          <CardContent className="space-y-6">
            {/* Default recipients */}
            <div className="space-y-3">
              <Label className="text-sm font-medium">Destinatarios padrao</Label>
              {recipients.length > 0 && (
                <div className="flex flex-wrap gap-2">
                  {recipients.map((email) => (
                    <Badge key={email} variant="secondary" className="gap-1 pr-1">
                      {email}
                      <button
                        type="button"
                        onClick={() => handleRemoveEmail(email)}
                        className="ml-1 hover:text-destructive rounded-full"
                      >
                        <X className="h-3 w-3" />
                      </button>
                    </Badge>
                  ))}
                </div>
              )}
              <div className="flex gap-2">
                <Input
                  type="email"
                  placeholder="email@exemplo.com"
                  value={newEmail}
                  onChange={(e) => setNewEmail(e.target.value)}
                  onKeyDown={(e) => e.key === 'Enter' && (e.preventDefault(), handleAddEmail())}
                  className="flex-1"
                />
                <Button type="button" variant="outline" size="icon" onClick={handleAddEmail}>
                  <Plus className="h-4 w-4" />
                </Button>
              </div>
            </div>

            {/* Permission toggles */}
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <div className="space-y-0.5">
                  <Label htmlFor="user-can-edit">Utilizadores podem editar</Label>
                  <p className="text-xs text-muted-foreground">
                    Permitir adicionar emails adicionais
                  </p>
                </div>
                <Switch
                  id="user-can-edit"
                  checked={userCanEdit}
                  onCheckedChange={setUserCanEdit}
                />
              </div>

              <div className="flex items-center justify-between">
                <div className="space-y-0.5">
                  <Label htmlFor="defaults-replaceable">Emails padrao substituiveis</Label>
                  <p className="text-xs text-muted-foreground">
                    Permitir remover emails padrao
                  </p>
                </div>
                <Switch
                  id="defaults-replaceable"
                  checked={defaultsReplaceable}
                  onCheckedChange={setDefaultsReplaceable}
                  disabled={!userCanEdit}
                />
              </div>
            </div>

            {/* Save button */}
            <div className="flex justify-end">
              <Button onClick={handleSave} disabled={isSaving}>
                {isSaving ? (
                  <>
                    <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                    A guardar...
                  </>
                ) : (
                  'Guardar'
                )}
              </Button>
            </div>
          </CardContent>
        </CollapsibleContent>
      </Card>
    </Collapsible>
  )
}
```
  </action>
  <verify>
File exists: `ls src/app/(dashboard)/admin/settings/email-settings-section.tsx`
Export function: `grep "export function EmailSettingsSection" src/app/(dashboard)/admin/settings/email-settings-section.tsx`
Uses action: `grep "updateEmailSettings" src/app/(dashboard)/admin/settings/email-settings-section.tsx`
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>EmailSettingsSection component created with recipient management and toggles</done>
</task>

<task type="auto">
  <name>Task 3: Create ColumnConfigTable component and sections</name>
  <files>src/app/(dashboard)/admin/settings/export-fields-section.tsx</files>
  <action>
Create the export fields section with reusable column config table:

```typescript
'use client'

import { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Switch } from '@/components/ui/switch'
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from '@/components/ui/collapsible'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { ChevronDown, Loader2, FileSpreadsheet, RefreshCw } from 'lucide-react'
import { toast } from 'sonner'
import type { ExportColumnConfig } from '@/types/export-config'
import { updateExportColumnConfig, syncExportColumns } from './actions'

interface ExportFieldsSectionProps {
  initialColumns: ExportColumnConfig[]
}

interface ColumnState {
  id: number
  column_name: string
  display_name: string
  visible: boolean
  display_order: number
  source_table: string
}

export function ExportFieldsSection({ initialColumns }: ExportFieldsSectionProps) {
  const [isOpen, setIsOpen] = useState(true)
  const [isSaving, setIsSaving] = useState(false)
  const [isSyncing, setIsSyncing] = useState(false)
  const [columns, setColumns] = useState<ColumnState[]>(
    initialColumns.map(c => ({
      id: c.id,
      column_name: c.column_name,
      display_name: c.display_name,
      visible: c.visible,
      display_order: c.display_order,
      source_table: c.source_table,
    }))
  )

  const rfpItemsColumns = columns.filter(c => c.source_table === 'rfp_items')
  const matchSuggestionsColumns = columns.filter(c => c.source_table === 'rfp_match_suggestions')

  const updateColumn = (id: number, field: keyof ColumnState, value: string | boolean | number) => {
    setColumns(columns.map(c =>
      c.id === id ? { ...c, [field]: value } : c
    ))
  }

  const handleSave = async () => {
    setIsSaving(true)
    try {
      const result = await updateExportColumnConfig(
        columns.map(c => ({
          id: c.id,
          display_name: c.display_name,
          visible: c.visible,
          display_order: c.display_order,
        }))
      )

      if (result.success) {
        toast.success('Configuracao de exportacao guardada')
      } else {
        toast.error(result.error || 'Erro ao guardar')
      }
    } catch (error) {
      toast.error('Erro ao guardar configuracao')
    } finally {
      setIsSaving(false)
    }
  }

  const handleSync = async () => {
    setIsSyncing(true)
    try {
      const result = await syncExportColumns()
      if (result.success) {
        toast.success('Colunas sincronizadas')
        // Page will reload due to revalidatePath
      } else {
        toast.error(result.error || 'Erro ao sincronizar')
      }
    } catch (error) {
      toast.error('Erro ao sincronizar colunas')
    } finally {
      setIsSyncing(false)
    }
  }

  const renderTable = (tableColumns: ColumnState[], tableName: string) => (
    <div className="space-y-2">
      <h4 className="font-medium text-sm">{tableName}</h4>
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead className="w-[200px]">Campo</TableHead>
            <TableHead>Nome de Exibicao</TableHead>
            <TableHead className="w-[80px] text-center">Visivel</TableHead>
            <TableHead className="w-[80px] text-center">Ordem</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {tableColumns.map((col) => (
            <TableRow key={col.id}>
              <TableCell className="font-mono text-sm">{col.column_name}</TableCell>
              <TableCell>
                <Input
                  value={col.display_name}
                  onChange={(e) => updateColumn(col.id, 'display_name', e.target.value)}
                  className="h-8"
                />
              </TableCell>
              <TableCell className="text-center">
                <Switch
                  checked={col.visible}
                  onCheckedChange={(v) => updateColumn(col.id, 'visible', v)}
                />
              </TableCell>
              <TableCell className="text-center">
                <Input
                  type="number"
                  value={col.display_order}
                  onChange={(e) => updateColumn(col.id, 'display_order', parseInt(e.target.value) || 0)}
                  className="h-8 w-16 text-center"
                />
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  )

  return (
    <Collapsible open={isOpen} onOpenChange={setIsOpen}>
      <Card>
        <CollapsibleTrigger asChild>
          <CardHeader className="cursor-pointer hover:bg-muted/50 transition-colors">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <FileSpreadsheet className="h-5 w-5" />
                <div>
                  <CardTitle className="text-lg">Campos de Exportacao</CardTitle>
                  <CardDescription>
                    Configurar colunas visiveis nas exportacoes Excel
                  </CardDescription>
                </div>
              </div>
              <ChevronDown className={`h-5 w-5 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
            </div>
          </CardHeader>
        </CollapsibleTrigger>
        <CollapsibleContent>
          <CardContent className="space-y-6">
            {renderTable(rfpItemsColumns, 'Itens do RFP (rfp_items)')}
            {renderTable(matchSuggestionsColumns, 'Sugestoes de Match (rfp_match_suggestions)')}

            <div className="flex justify-between">
              <Button variant="outline" onClick={handleSync} disabled={isSyncing}>
                {isSyncing ? (
                  <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                ) : (
                  <RefreshCw className="mr-2 h-4 w-4" />
                )}
                Sincronizar Colunas
              </Button>
              <Button onClick={handleSave} disabled={isSaving}>
                {isSaving ? (
                  <>
                    <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                    A guardar...
                  </>
                ) : (
                  'Guardar'
                )}
              </Button>
            </div>
          </CardContent>
        </CollapsibleContent>
      </Card>
    </Collapsible>
  )
}
```
  </action>
  <verify>
File exists: `ls src/app/(dashboard)/admin/settings/export-fields-section.tsx`
Export function: `grep "export function ExportFieldsSection" src/app/(dashboard)/admin/settings/export-fields-section.tsx`
Two tables: `grep "rfp_items\|rfp_match_suggestions" src/app/(dashboard)/admin/settings/export-fields-section.tsx`
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>ExportFieldsSection component created with two column tables</done>
</task>

<task type="auto">
  <name>Task 4: Create InventoryFieldsSection component</name>
  <files>src/app/(dashboard)/admin/settings/inventory-fields-section.tsx</files>
  <action>
Create the inventory fields section (similar pattern to export fields):

```typescript
'use client'

import { useState } from 'react'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Switch } from '@/components/ui/switch'
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from '@/components/ui/collapsible'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import { ChevronDown, Loader2, Package } from 'lucide-react'
import { toast } from 'sonner'
import { updateInventoryColumnConfig } from './actions'

interface InventoryColumn {
  id: number
  column_name: string
  display_name: string
  visible: boolean
  sortable: boolean
  searchable: boolean
  display_order: number
}

interface InventoryFieldsSectionProps {
  initialColumns: InventoryColumn[]
}

export function InventoryFieldsSection({ initialColumns }: InventoryFieldsSectionProps) {
  const [isOpen, setIsOpen] = useState(false) // Start collapsed
  const [isSaving, setIsSaving] = useState(false)
  const [columns, setColumns] = useState(initialColumns)

  const updateColumn = (id: number, field: keyof InventoryColumn, value: string | boolean | number) => {
    setColumns(columns.map(c =>
      c.id === id ? { ...c, [field]: value } : c
    ))
  }

  const handleSave = async () => {
    setIsSaving(true)
    try {
      const result = await updateInventoryColumnConfig(
        columns.map(c => ({
          id: c.id,
          display_name: c.display_name,
          visible: c.visible,
          display_order: c.display_order,
        }))
      )

      if (result.success) {
        toast.success('Configuracao do inventario guardada')
      } else {
        toast.error(result.error || 'Erro ao guardar')
      }
    } catch (error) {
      toast.error('Erro ao guardar configuracao')
    } finally {
      setIsSaving(false)
    }
  }

  return (
    <Collapsible open={isOpen} onOpenChange={setIsOpen}>
      <Card>
        <CollapsibleTrigger asChild>
          <CardHeader className="cursor-pointer hover:bg-muted/50 transition-colors">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <Package className="h-5 w-5" />
                <div>
                  <CardTitle className="text-lg">Campos do Inventario</CardTitle>
                  <CardDescription>
                    Configurar colunas visiveis na pagina de inventario
                  </CardDescription>
                </div>
              </div>
              <ChevronDown className={`h-5 w-5 transition-transform ${isOpen ? 'rotate-180' : ''}`} />
            </div>
          </CardHeader>
        </CollapsibleTrigger>
        <CollapsibleContent>
          <CardContent className="space-y-6">
            <Table>
              <TableHeader>
                <TableRow>
                  <TableHead className="w-[200px]">Campo</TableHead>
                  <TableHead>Nome de Exibicao</TableHead>
                  <TableHead className="w-[80px] text-center">Visivel</TableHead>
                  <TableHead className="w-[80px] text-center">Ordem</TableHead>
                </TableRow>
              </TableHeader>
              <TableBody>
                {columns.map((col) => (
                  <TableRow key={col.id}>
                    <TableCell className="font-mono text-sm">{col.column_name}</TableCell>
                    <TableCell>
                      <Input
                        value={col.display_name}
                        onChange={(e) => updateColumn(col.id, 'display_name', e.target.value)}
                        className="h-8"
                      />
                    </TableCell>
                    <TableCell className="text-center">
                      <Switch
                        checked={col.visible}
                        onCheckedChange={(v) => updateColumn(col.id, 'visible', v)}
                      />
                    </TableCell>
                    <TableCell className="text-center">
                      <Input
                        type="number"
                        value={col.display_order}
                        onChange={(e) => updateColumn(col.id, 'display_order', parseInt(e.target.value) || 0)}
                        className="h-8 w-16 text-center"
                      />
                    </TableCell>
                  </TableRow>
                ))}
              </TableBody>
            </Table>

            <div className="flex justify-end">
              <Button onClick={handleSave} disabled={isSaving}>
                {isSaving ? (
                  <>
                    <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                    A guardar...
                  </>
                ) : (
                  'Guardar'
                )}
              </Button>
            </div>
          </CardContent>
        </CollapsibleContent>
      </Card>
    </Collapsible>
  )
}
```
  </action>
  <verify>
File exists: `ls src/app/(dashboard)/admin/settings/inventory-fields-section.tsx`
Export function: `grep "export function InventoryFieldsSection" src/app/(dashboard)/admin/settings/inventory-fields-section.tsx`
Uses action: `grep "updateInventoryColumnConfig" src/app/(dashboard)/admin/settings/inventory-fields-section.tsx`
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>InventoryFieldsSection component created with column configuration table</done>
</task>

<task type="auto">
  <name>Task 5: Create admin settings page</name>
  <files>src/app/(dashboard)/admin/settings/page.tsx</files>
  <action>
Create the main settings page that assembles all sections:

```typescript
import { createClient } from '@/lib/supabase/server'
import { EmailSettingsSection } from './email-settings-section'
import { ExportFieldsSection } from './export-fields-section'
import { InventoryFieldsSection } from './inventory-fields-section'

export default async function AdminSettingsPage() {
  const supabase = await createClient()

  // Fetch app settings
  const { data: appSettings } = await supabase
    .from('app_settings')
    .select('*')
    .eq('id', 1)
    .single()

  // Fetch export column config
  const { data: exportColumns } = await supabase
    .from('export_column_config')
    .select('*')
    .order('source_table')
    .order('display_order')

  // Fetch inventory column config
  const { data: inventoryColumns } = await supabase
    .from('inventory_column_config')
    .select('*')
    .order('display_order')

  return (
    <div className="flex flex-1 flex-col gap-6">
      <div>
        <h1 className="text-3xl font-bold tracking-tight">Definicoes</h1>
        <p className="text-muted-foreground">
          Configuracoes gerais da aplicacao
        </p>
      </div>

      <div className="space-y-4">
        <EmailSettingsSection initialSettings={appSettings} />
        <ExportFieldsSection initialColumns={exportColumns || []} />
        <InventoryFieldsSection initialColumns={inventoryColumns || []} />
      </div>
    </div>
  )
}
```
  </action>
  <verify>
File exists: `ls src/app/(dashboard)/admin/settings/page.tsx`
Fetches all data: `grep "app_settings\|export_column_config\|inventory_column_config" src/app/(dashboard)/admin/settings/page.tsx`
All sections rendered: `grep "EmailSettingsSection\|ExportFieldsSection\|InventoryFieldsSection" src/app/(dashboard)/admin/settings/page.tsx`
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Admin settings page created with all three sections</done>
</task>

<task type="auto">
  <name>Task 6: Update sidebar with settings link</name>
  <files>src/components/layout/app-sidebar.tsx</files>
  <action>
Update the sidebar to add Definicoes link in admin section:

1. Update adminItems array to include settings:
```typescript
const adminItems = [
  { title: 'Utilizadores', url: '/admin/users', icon: Users },
  { title: 'Definicoes', url: '/admin/settings', icon: Settings },
]
```

The Settings icon is already imported at the top (used in SidebarFooter).

2. Remove the duplicate settings link from SidebarFooter since it's now in admin section.
   Delete or comment out the SidebarFooter section that shows Definicoes for all users.

Actually, keep SidebarFooter for non-admin users but only show in admin section for admins.
Better approach: Keep footer settings for all users (general user settings), add admin settings to admin section.

Revised approach - keep both:
- Footer "Definicoes" at /settings for user preferences (future)
- Admin "Definicoes" at /admin/settings for app configuration

Update adminItems:
```typescript
const adminItems = [
  { title: 'Utilizadores', url: '/admin/users', icon: Users },
  { title: 'Definicoes', url: '/admin/settings', icon: Settings },
]
```
  </action>
  <verify>
Admin settings in array: `grep "/admin/settings" src/components/layout/app-sidebar.tsx`
Settings icon imported: `grep "Settings" src/components/layout/app-sidebar.tsx | head -1`
TypeScript compiles: `npx tsc --noEmit`
  </verify>
  <done>Sidebar shows Definicoes link in admin section</done>
</task>

</tasks>

<verification>
1. /admin/settings page exists and renders
2. Sidebar shows Definicoes under Administracao section
3. Email section allows adding/removing recipients and toggling flags
4. Export fields section shows two tables for rfp_items and rfp_match_suggestions
5. Inventory fields section shows artigos columns
6. All save buttons persist changes to database
7. Sync columns button works for export fields
8. TypeScript compiles without errors
</verification>

<success_criteria>
- Admin settings page accessible at /admin/settings
- All three configuration sections work correctly
- Changes persist to database
- Collapsible sections for cleaner UI
- Consistent styling with rest of admin pages
</success_criteria>

<output>
After completion, create `.planning/phases/09-export-email-admin/09-05-SUMMARY.md`
</output>
